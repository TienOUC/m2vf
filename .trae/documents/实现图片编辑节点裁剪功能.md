# 实现图片编辑节点裁剪功能

## 1. 分析现有代码结构
- 项目使用 `@toast-ui/react-image-editor` 3.15.2 版本
- 已有裁剪按钮，但点击事件为空
- 图片编辑流程：ImageNode → CustomImageEditor → ImageEditor → ToastUIEditor

## 2. 实现步骤

### 2.1 修改 NodeToolbar.tsx
- 为裁剪按钮添加点击事件处理，调用 `onEditStart` 方法
- 确保裁剪按钮只在图片节点上显示

### 2.2 更新 ImageNode.tsx
- 确保 `onEditStart` 方法正确处理裁剪功能
- 保持现有编辑状态管理逻辑

### 2.3 配置 CustomImageEditor.tsx
- 确保 tui.image-editor 配置中包含裁剪功能
- 配置裁剪相关的工具栏选项
- 优化裁剪界面布局

### 2.4 增强 ImageEditor.tsx
- 确保编辑器实例正确初始化
- 处理编辑器加载失败的情况

### 2.5 添加异常处理
- 处理图片加载失败的情况
- 处理裁剪操作失败的情况
- 添加内存优化，确保编辑器实例正确销毁

### 2.6 实现编辑历史记录
- 确保裁剪操作后图片状态正确更新
- 保持现有 `handleEditSave` 和 `handleEditCancel` 逻辑

## 3. 技术要点
- 使用 tui.image-editor 内置的裁剪 API
- 配置 `includeUI.menu` 包含 `crop` 选项
- 设置 `initMenu: 'crop'` 确保打开编辑器时默认进入裁剪模式
- 处理不同版本 API 兼容性
- 添加适当的错误处理和日志

## 4. 代码规范
- 添加必要的注释说明
- 遵循现有代码风格
- 确保代码模块化和可维护性

## 5. 测试要点
- 裁剪按钮点击事件正常触发
- 裁剪界面正确显示
- 裁剪操作能够保存和取消
- 裁剪后的图片正确更新
- 异常情况下的处理

通过以上步骤，将实现图片编辑节点工具栏中裁剪按钮的完整功能逻辑，确保用户能够方便地使用裁剪功能编辑图片。